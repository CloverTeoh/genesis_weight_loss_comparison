labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 16) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(size = 10, color = "black"),
plot.title = element_text(face = "bold", size = 14)
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 30) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(size = 10, color = "black"),
plot.title = element_text(face = "bold", size = 14)
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
p3
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 15) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(size = 10, color = "black"),
plot.title = element_text(face = "bold", size = 14)
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
p3
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal() +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(size = 10, color = "black"),
plot.title = element_text(face = "bold", size = 14)
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
viewer_dim <- dev.size("in")
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = viewer_dim[1],
height = viewer_dim[2],
units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 30) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(size = 10, color = "black"),
plot.title = element_text(face = "bold", size = 14)
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 35) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 35) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4DBBD5", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 40) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 40) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "white", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "black", fontface = "bold")
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "black", fontface = "bold", size = 30)
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "black", fontface = "bold", size = 25)
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "black", fontface = "bold", size = 20)
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 3. 繪圖
p3 <- ggplot(data_long, aes(x = Group, y = Percentage, fill = Component)) +
geom_bar(stat = "identity", width = 0.7) +
coord_flip() +  # 橫向長條圖，較易閱讀藥物名稱
# 設定 Nature 風格配色：瘦體重用紅色系，脂肪用藍色系
scale_fill_manual(
values = c("Lean_Mass" = "#4393c3", "Fat_Mass" = "#E64B35"),
labels = c("Lean_Mass" = "Lean Mass Loss Fraction", "Fat_Mass" = "Fat Mass Loss Fraction")
) +
labs(
title = "Composition of Weight Loss",
subtitle = "Comparison of Lean vs. Fat Mass Loss Fractions",
x = "",
y = "Percentage of Total Weight Loss (%)",
fill = "Component"
) +
theme_minimal(base_size = 45) +
theme(
text = element_text(family = "sans"),
legend.position = "bottom",
panel.grid.minor = element_blank(),
axis.text = element_text(color = "black"),
plot.title = element_text(face = "bold")
) +
geom_text(aes(label = paste0(Percentage, "%")),
position = position_stack(vjust = 0.5),
color = "black", fontface = "bold", size = 15)
p3
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 7, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 5, height = 6, units = "in", dpi = 300,
scale = 1.5)
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 6, height = 5, units = "in", dpi = 300,
scale = 1.5)
# 儲存圖片
ggsave("fat_lean_mass_loss_fraction.jpeg", p3,
width = 6, height = 4, units = "in", dpi = 300,
scale = 1.5)
library(pacman)
pacman::p_load(gridExtra, cobalt, table1, FSA, purrr, nortest, showtext, stringr, scales, forcats, plotly, patchwork, tidyverse, googleVis, magrittr, knitr, kableExtra, dplyr, readr, readxl, tibble, showtext, ggvenn, ggplot2,knitr, kableExtra, openxlsx, lubridate, cowplot, ggpubr, webshot)
# ========================
# input data
# ========================
setwd("/Users/clover_teoh/Documents/cofit/GLP_1_成效分析/glp1_compare_update_20260114")
getwd()
glp1_data <- read.csv("glp_1_users_20260108.csv")
raw_data <- read_excel("final_analysis_ready_2019_20260108.xlsx")
paper_data <- read_excel("paper_GLP_1_dataset_20251203.xlsx", sheet = "Sheet1")
# 抓到有5個人的client_id, started_at, adjusted_end一樣的人
raw_data %>%
filter(client_id %in% c("379029","381744","736733","746478","754442")) %>%
group_by(client_id, started_at, adjusted_end) %>%
summarise(
n = n(),
across(everything(), n_distinct, .names = "n_distinct_{.col}"),
all_unique = all(across(everything(), n_distinct) == 1),
.groups = "drop"
)
nrow(raw_data)
raw_data_clean <- raw_data %>%
# 為所有記錄按 client_id, started_at, adjusted_end 分組
group_by(client_id, started_at, adjusted_end) %>%
# 對於這 5 個特定的 client_id，如果有重複就只保留第一筆
filter(
!(client_id %in% c("379029", "381744", "736733", "746478", "754442") &
n() > 1 &
row_number() > 1)
) %>%
ungroup()
nrow(raw_data_clean) #應該要是raw_data -5
510000*3/100
510000*2/100
510000*1/100
